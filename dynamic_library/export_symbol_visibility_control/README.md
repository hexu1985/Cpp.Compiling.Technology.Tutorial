### 控制动态库符号的可见性

Linux环境下动态库的所有链接器符号默认均处于公开状态，这意味着任何尝试动态链接该库的程序都能看到这些符号。
尽管这种默认设置简化了动态库的操作流程，但保持所有符号可见并非推荐做法，其原因有多方面：
向用户暴露过多内部信息绝非良策；同时，仅加载必要的最小化符号与加载海量符号相比，能显著缩短库文件的加载时间。

在构建阶段实现符号导出控制主要通过以下几种机制：
此外，还可通过对动态库二进制文件执行strip命令行工具来实现强制处理。
最终，开发者可以组合运用多种方法，以达到精确控制动态库符号可见性的目的。

gcc编译器提供了多种机制来设置链接器符号的可见性：

#### 方法1：（影响所有代码）

`-fvisibility compiler flag`

根据GCC手册页，通过向编译器传递编译器选项`-fvisibility=hidden`就可以将所有的动态库符号置为对外不可见。

#### 方法2：（只影响单个符号）

`__attribute__ ((visibility("<default | hidden>")))`

通过在函数前面使用编译属性修饰，你可以指示链接器允许（默认行为）或者禁止（隐藏符号）对外提供该符号。

#### 方法3：（影响单个符号或者一组符号）

`#pragma GCC visibility [push | pop]`

该选项通常用在头文件中。比如：

```
#pragma visibility push(hidden)
void someprivatefunction_1(void);
void someprivatefunction_2(void);
...
void someprivatefunction_N(void);
#pragma visibility pop
```

你就可以将#pragma语句之间所有声明的函数设定成对外不可见的。

程序员可以根据实际需求，以任意方式组合使用这三种方法。

#### 参考资料:
《高级C/C++编译技术》: 6.2.3 控制动态库符号的可见性

